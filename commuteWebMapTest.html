<!DOCTYPE html>
<html>
<head>
	
	<title>Commute Times</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/1-col-portfolio.css" rel="stylesheet">
    
    <!-- Leaflet css and js files -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
	<!-- JS file containing object information for my map -->
    <script src = "commute_times2.js"> </script>
	<!--Personal CSS file -->
    <link rel = 'stylesheet' href = 'portfolio.css' type = 'text/css' />
	<style>
		/*style info for lefalet legends*/
		.legend {
			line-height: 18px;
			color: black;
			border-radius: 5px;
			background-color: #f5f5f5;
			padding-right: 1em;
			padding-left: 0.5em;
			padding-bottom: 0.5em;
		}
		.legend i {
			width: 18px;
			height: 18px;
			float: left;
			margin-right: 8px;
			opacity: 0.7;
			border-radius: 2px;
		}
		/*style info for leaflet hover box*/
		.info {
		    padding: 6px 8px;
		    background: white;
		    background: rgba(255,255,255,0.8);
		    box-shadow: 0 0 15px rgba(0,0,0,0.2);
		    border-radius: 5px;
		}
		.info h4 {
		    margin: 0 0 5px;
		    color: #777;
		}
		
	</style>
	
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
      <div class="container">
        <a class="navbar-brand" href="#">Devin Simmons</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item active">
              <a class="nav-link" href="index.html">Home
                <span class="sr-only">(current)</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="projects.html">Projects</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="resume.html">Resume</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="contact.html">Contact</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Page content -->
    <div id="mapid" class = 'webmap' style = 'height: 75vh;'></div>
	<table>
		<tr>
			<td>
				<form style = 'display: inline;'>
					<fieldset style="width: 200px; margin-top: 0.3em; margin-bottom: 1em; margin-left: 12vw;
									border: 2px solid black; padding: 0.5em">
						<label><input type = 'radio' name = 'commuteLength' id = 'under30' checked = "checked" />Under 30 minutes</label><br />
						<label><input type = 'radio' name = 'commuteLength' id = 'under60' />30 - 59 minutes</label><br />
						<label><input type = 'radio' name = 'commuteLength' id = 'over60' />60 minutes or more</label><br />
						<input type = 'button' value = 'New Map' onclick = 'loadNewLayer();' />
					</fieldset>
				</form>
			</td>
			<td>
				<p style = 'margin-right: 12vw; margin-left: 1em;'>This map, produced using census (ACS) data from 2016,
				displays commute times for each state. The data has been grouped into the three brackets seen in the form
				to the left. To create this map, I first gathered the data and joined it to a US states shapefile. After
				converting this to a GeoJSON, I was able to write Leaflet functions that dynamically change the map's legend and
				choropleth values.</p>
			</td>
		</tr>
	</table>
    <!-- Footer -->
    <footer class="py-5 bg-dark">
      <div class="container">
        <p class="m-0 text-center text-white">Copyright &copy; Devin Simmons 2018</p>
      </div>
      <!-- /.container -->
    </footer>

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script>
	
	if(L.Browser.ie || L.Browser.edge) {
		alert('Please try loading this page in Chrome or Firefox');
		
	}
	//three functions used to define color for the three different possible layers
	//it was necessary to do three different classifications bc i used a natural breaks classifier for each layer
	function getColorUnd30(d) {
		return d > 76  ? '#006d2c' :
            d > 70  ? '#2ca25f' :
            d > 62   ? '#66c2a4' :
            d > 53   ? '#b2e2e2' :
		    d > 0 ? '#edf8fb' :        
                      '#FFEDA0';
	}
	function getColorUnd60(d) {
		return d > 31 ? '#006d2c' :
           d > 26  ? '#2ca25f' :
           d > 21  ? '#66c2a4' :
           d > 14  ? '#b2e2e2' :
           d > 0   ? '#edf8fb' :
           
                      '#FFEDA0';
	}
	function getColorOvr60(d) {
		return d > 13  ? '#006d2c' :
            d > 10  ? '#2ca25f' :
            d > 7   ? '#66c2a4' :
            d > 5   ? '#b2e2e2' :
		    d > 0 ? '#edf8fb' : 
                      '#FFEDA0';
	}
	
	//leaflet stuff to create map variable
	var commute = L.map('mapid').setView([41.505, -90], 3);

	L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1Ijoic2ltbW9uc2QiLCJhIjoiY2poeXk3YzlpMHJsbTNwcnYyNW1zeG9vMCJ9.sRhhJsrU0qUGbM7LiSrW_Q', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
			'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
            '<a href="https://factfinder.census.gov/faces/tableservices/jsf/pages/productview.xhtml?pid=ACS_16_1YR_S0802&prodType=table">American Community Survey, </a>' +
			'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
		id: 'mapbox.streets'
	}).addTo(commute);
	
	
	//defines a styling for the displayed layer. the user's input is determined, 
	//and then the associated property mapped.
	function styleUnd_30(feature) {
		return {
			fillColor: getColorUnd30(feature.properties.Und_30),
			weight: 2,
			opacity: 1,
			color: 'white',
			dashArray: '3',
			fillOpacity: 0.7,
		};
	}
	function styleUnd_60(feature) {
		return {
			fillColor: getColorUnd60(feature.properties.Und_60),
			weight: 2,
			opacity: 1,
			color: 'white',
			dashArray: '3',
			fillOpacity: 0.7
		};
	}
	function styleOvr_60(feature){
		return {
			fillColor: getColorOvr60(feature.properties.Ovr_60),
			weight: 2,
			opacity: 1,
			color: 'white',
			dashArray: '3',
			fillOpacity: 0.7
		};
	}
	
	// control that shows state info on hover
	var info = L.control();

	info.onAdd = function(commute){
		this._div = L.DomUtil.create('div', 'info');
		this.update();
		return this._div;
	};
	
	//defines an event listener if the user mouses over a feature
	function highlightFeature(e) {
		var layer = e.target;
	
		layer.setStyle({
		    weight: 5,
		    color: '#666',
		    dashArray: '',
		    fillOpacity: 0.7
		});
	
		if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
		    layer.bringToFront();
		}
		info.update(layer.feature.properties);
	}
	
	var und_30Layer;
	var und_60Layer;
	var ovr_60Layer;
	//event listener for when the mouse moves off a feature
	function resetHighlight(e) {
	    var layers = [und_30Layer, und_60Layer, ovr_60Layer];
		for(var i = 0; i<layers.length; i++) {
			if(commute.hasLayer(layers[i])) {
				layers[i].resetStyle(e.target);
			}
		}
		info.update();
	}
	
	
	
	//updates text in info box based on user selection
	info.update = function (commuteTimes) {
		if(commute.hasLayer(und_30Layer)) {
			this._div.innerHTML = '<h6>Percentage of Commutes Under 30 Minutes</h6>' +  (commuteTimes ?
				'<b>' + commuteTimes.NAME + '</b><br />' + commuteTimes.Und_30 + ' %'
				: 'Hover over a state');
		}
		if(commute.hasLayer(und_60Layer)) {
			this._div.innerHTML = '<h6>Percentage of Commutes 30 to 59 Minutes</h6>' +  (commuteTimes ?
				'<b>' + commuteTimes.NAME + '</b><br />' + commuteTimes.Und_60 + ' %'
				: 'Hover over a state');
		}
		if(commute.hasLayer(ovr_60Layer)) {
			this._div.innerHTML = '<h6>Percentage of Commutes 60 Minutes or Longer</h6>' +  (commuteTimes ?
				'<b>' + commuteTimes.NAME + '</b><br />' + commuteTimes.Ovr_60 + ' %'
				: 'Hover over a state');
		}
		
	};
		
	
	//zooms to feature if the user clicks on it
	function zoomToFeature(e) {
		map.fitBounds(e.target.getBounds());
	}
	//function that attaches listeners to layers so that info can be displayed
	function onEachFeature(feature, layer) {
		layer.on({
		    mouseover: highlightFeature,
		    mouseout: resetHighlight,
		    click: zoomToFeature
		});
	}
	
	
	//the three layers that will be selectable. They call their associated style functions
	var und_30Layer = L.geoJSON(commuteTimes, {
			style: styleUnd_30,
			onEachFeature: onEachFeature
		});
	var und_60Layer = L.geoJSON(commuteTimes, {
			style: styleUnd_60,
			onEachFeature: onEachFeature
		});
	var ovr_60Layer = L.geoJSON(commuteTimes, {
			style: styleOvr_60,
			onEachFeature: onEachFeature
		});
	
	//how the selectable layers will be presented in the layers control
	var displayedLayers = {
		"Under 30 Minutes": und_30Layer,
		"30 Minutes to 59 Minutes": und_60Layer,
		"60 Minutes or Longer": ovr_60Layer
	};
	
	//creates the layer control widget
	var layerWidget = L.control.layers(displayedLayers);
	layerWidget.setPosition('bottomleft');
	layerWidget.addTo(commute);
	
	
	
	//initializes the legend
	var legend = L.control({position: 'bottomright'});
	//empty array that will contain the grades for the legend after the user selects
	//the map they want to see. it needs to be global so it is defined outside of that
	//function
	var legendGrades = [];
	
	//anytime the legend var is added to the map this function runs
	legend.onAdd = function (commute) {
		var div = L.DomUtil.create('div', 'info legend'),
			grades = legendGrades;
			labels = ["<b>Percent of Commutes</b>"];
			//adds label to the top of the legend
			div.innerHTML = labels + '<br>';
		for (var i = 0; i < grades.length; i++) {
			//boolean statements ensure that each radio button has the correct colors dispayed
			//in the legend
			if(under30.checked) {
				div.innerHTML +=
					'<i style="background:' + getColorUnd30(grades[i] + 1) + '"></i> ' +
					grades[i] + (grades[i + 1] ? ' &ndash; ' + grades[i + 1] + '<br>' : '+');
			}
			if(under60.checked) {
				div.innerHTML +=
					'<i style="background:' + getColorUnd60(grades[i] + 1) + '"></i> ' +
					grades[i] + (grades[i + 1] ? ' &ndash; ' + grades[i + 1] + '<br>' : '+');
			}
			if(over60.checked) {
				div.innerHTML +=
					'<i style="background:' + getColorOvr60(grades[i] + 1) + '"></i> ' +
					grades[i] + (grades[i + 1] ? ' &ndash; ' + grades[i + 1] + '<br>' : '+');
			}		
		}	
		return div;
	};
	
	
	//function that loads layer based on user selection
	function loadNewLayer() {
		//first it deletes the previous layer, then calls the style function again to create
		// a new one
		commute.removeLayer(currentLayer);
		
		//loads new layer with new color values
		currentLayer = L.geoJSON(commuteTimes, {
			style: style,
			onEachFeature: onEachFeature
		}).addTo(commute);
		
		//creates a unique array of legend values for each radio button
		if(under30.checked) {
			legendGrades = [0, 53, 62, 70, 76];
		}
		if(under60.checked) {
			legendGrades = [0, 14, 21, 26, 31];
		}
		if(over60.checked) {
			legendGrades = [0, 5, 7, 10, 13];
		}
	
		//removes the previous legend and then adds the new one		
		commute.removeControl(legend);
		legend.addTo(commute);
		
		info.addTo(commute);
	}
	info.addTo(commute);
	
</script>

</body>
</html>